import { serverSideTranslations } from 'next-i18next/serverSideTranslations'
import { BlogContainer } from '../../../components/blog/BlogContainer'
import { ImagesV2 } from '@components/common/images-v2'
import { http } from '@services/http'
import { time } from '@utils/time'

> æ—¢ç„¶å¾®ä¿¡éƒ½æ”¯æŒ Live Photo äº†ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¸å¯ä»¥æ”¯æŒï¼Ÿ

#### Apple, ä½ çš„ SDK çœŸçš„å¾ˆç³Ÿç³• ğŸ’¢

[Apple å®˜æ–¹çš„ Live Photo çš„ JS SDK](https://developer.apple.com/documentation/LivePhotosKitJS)ï¼ŒçœŸçš„å¾ˆéš¾ç”¨ã€‚è¦ä¸æ˜¯æˆ‘å…ˆå‰è‡ªå·±å†™äº†ä¸€ç‰ˆæœ¬ Bugs ä¸€å †ï¼Œæ‰“æ­»æˆ‘ä¹Ÿä¸ç”¨è¿™ä¸ªç ´ç©æ„å„¿ï¼

ç”±äºæ˜¯ Canvas ç»˜åˆ¶ï¼Œä¸ºäº†ä¿è¯å¯ä»¥æ ¹æ®çª—å£å¤§å°è°ƒæ•´å°ºå¯¸ï¼Œå†™äº†éå¸¸å¤šçš„è„ä»£ç 

**è¯·æ¬£èµï¼š**

```ts
useEffect(() => {
  const fn = async () => {
    if (!livePhotosKit) {
      livePhotosKit = await import('livephotoskit')
    }
    const container = document.getElementById(id)
    const img = document.getElementById(id + 'img')

    if (!container || !img) {
      return
    }

    const waitImgLoad = new Promise((r) => {
      img.addEventListener('load', r)
    })

    const videoArrayBuff = await fetch(videoSrc).then((res) =>
      res.arrayBuffer(),
    )

    // measure the size of the img
    let { width, height } = img.getBoundingClientRect()
    if (width === 0 || height === 0) {
      await waitImgLoad
      ;({ width, height } = img.getBoundingClientRect())
    }
    ratio.current = width / height
    // hide img
    // img.style.opacity = '0'
    // set the width and height of the container
    container.style.width = `${width}px`
    container.style.height = `${height}px`

    player.current = livePhotosKit.augmentElementAsPlayer(
      document.getElementById(id),
      {
        photoSrc: imgSrc,
        videoMimeType: 'video/mp4',
        videoSrc: videoArrayBuff,
      },
    )

    // measure the width of measure elem when it's size changes, set the size of player
    const observer = new ResizeObserver((entries) => {
      entries.forEach((entry) => {
        const { width } = entry.contentRect
        player.current.updateSize(width, width / ratio.current)
      })
    })
    observer.observe(img)

    return () => {
      observer.disconnect()
    }
  }
  fn()
}, [id, imgSrc, videoSrc])
```

#### ä¸ç®¡æ€ä¹ˆæ ·ï¼Œçœ‹çœ‹æ•ˆæœå§ ğŸ˜

<ImagesV2
  images={[
    {
      img: 'https://ltd-hong97-imgs.oss-cn-shanghai.aliyuncs.com/uploader/202506/IMG_4421%20Large_mbduvgnz.jpeg',
      video: 'https://ltd-hong97-imgs.oss-cn-shanghai.aliyuncs.com/uploader/202506/IMG_4421_mbduvg7c.mov',
      caption: 'A bunny ğŸ°'
    }
  ]}
  markdown
/>

<ImagesV2
  images={[
    {
      img: 'https://ltd-hong97-imgs.oss-cn-shanghai.aliyuncs.com/uploader/202506/IMG_4428%20Large_mbdvde5s.jpeg',
      video: 'https://ltd-hong97-imgs.oss-cn-shanghai.aliyuncs.com/uploader/202506/IMG_4428_mbdvde5f.mov',
      caption: '@åƒå²›æ¹–ï¼Œéšä¾¿æ‹ä¸€æ‹'
    }
  ]}
  markdown
/>

çœ‹èµ·æ¥è¿˜è¡Œï¼Œå°±æ˜¯ä¸çŸ¥é“è¿™ç©æ„å„¿å¯¹æˆ‘çš„ OSS æ¶ˆè€—å¤§ä¸å¤§

**å‰ä¸¤å¤©å·²ç»æ”¶åˆ°æ¬ è´¹è­¦å‘Šäº†ï¼**


export default BlogContainer

export async function getServerSideProps(context) {
  const { locale, query } = context
  const meta = await http.get('GetBlogMeta', {
    blogId: query?.key
  })
  time.setLocale(locale)
  return {
    props: {
      ...(await serverSideTranslations(locale, ['common', 'blog'])),
      meta: meta?.data,
      locale,
    },
  }
}

